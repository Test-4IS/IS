var g_map,sPath,answers=new Array,radioID="radio-choice-",myPos=new myPostion(!1),fl="I4ISevents.xml",eXML=new fileName("I4ISevents.xml");function noOfQuestions(){return 16}function swartzCalc(t){var e=CONFIG.get("SpeedOfLightKmPerSec"),a=2*(CONFIG.get("ConstOfGravity")/1e9)*t/(e*e),n=entropyCalc(1e3*a);document.swartz.R.value=a.toPrecision(2),document.swartz.E.value=n.toPrecision(2)}function entropyCalc(t){CONFIG.get("Boltzmann"),CONFIG.get("SpeedOfLightKmPerSec"),CONFIG.get("ConstOfGravity");return 4*Math.PI*t*t/(4*CONFIG.get("planckLength"))}function downloadXLM(){if(navigator.onLine){var n=encodeURI("https://github.com/Test-4IS/IS/tree/master/www/xml/I4ISevents.xml");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(t){sPath=t.root.toURL(),t.root.getFile("dummy.xml",{create:!0,exclusive:!1},function(t){var e=sPath+fl,a=new FileTransfer;t.remove(),a.download(n,e,function(t){console.log("download complete: "+t.toURI()),getEvent("ALL"),navigator.notification.alert("Events Data Refreshed !",onDoAlert,"Alert","OK")},function(t){console.log("download error source "+t.source),console.log("download error target "+t.target),console.log("upload error code: "+t.code),alert("FTP error : "+t.code),navigator.notification.alert("Events Data Refreshed Error:"+t.code,onDoAlert,"Alert","OK")})},fail)},fail)}else alert("No Network connection")}function fail(t){console.log(t.target.error.code),alert("File fail : "+t.target.error.code)}function ansTest1(t){for(var e,a=0,n=0,o=new Array,i=0;i<t;i++)void 0!==(e=$("input:radio[name="+("q"+(i+1))+"]:checked").val())&&(e==answers[i].ans?a+=1:(o[n]=answers[i],n+=1));dspMistakes(o),alert("score : "+a+" out of "+t)}function alertDismissed(){}function crtQues1(t,e){var a=" ";try{a=getData(getRandomNumbers(t),e),$("#eQues").html(a),$("div[data-role=page]").page("destroy").page()}catch(t){alert("crtQues1: "+t.message)}}function crtQues(t,e,a,n,o){var i,r=radioID+t,s="q"+t;try{i='<fieldset data-role="controlgroup" data-type="horizontal" >'+("<legend><b>Q"+t+". "+e+":</b></legend><br/>")+('<input type="radio" name="'+s+'" id="'+r+'a" value="1" data-mini="true"/>')+('<label for="'+r+'a">'+a+"</label>")+('<input type="radio" name="'+s+'" id="'+r+'b" value="2" data-mini="true"/>')+('<label for="'+r+'b">'+n+"</label>")+('<input type="radio" name="'+s+'" id="'+r+'c" value="3" data-mini="true"/>')+('<label for="'+r+'c">'+o+"</label>")+"</fieldset><br/>"}catch(t){alert("crtQues: "+t.message)}return i}function getData(e,t){var a,n,o,i,r,s,c,l,d,u=" ",h=0;d="H"==t?"xml/hard_questions.xml":"xml/easy_questions.xml",answers.length=0;try{return $.ajax({async:!1,type:"GET",url:d,success:function(t){$("question",t).each(function(t){-1!=e.indexOf(t+1)&&(a=$(this).find("ques").text(),o=$(this).find("ans1").text(),i=$(this).find("ans2").text(),r=$(this).find("ans3").text(),s=$(this).find("ans").text(),c=$(this).find("elink").text(),l=new xmlANS(h,a,o,i,r,s,c),answers[h]=l,n=crtQues(h+=1,a,o,i,r),u+=n)})},error:function(t,e,a){xmlError(t)}}),u}catch(t){return void alert("getData: "+t.message)}}function xmlError(t){404==t.status?alert("xml file not found"):alert("error: "+t.statusText)}function getRandomNumbers(t){var e=0,a=new Array,n=noOfQuestions();n<t&&(t=n);for(var o=0;o<t;o++){for(0;e=Math.floor(Math.random()*n+1),-1!=a.indexOf(e););a[o]=e}return a}var mydata=[];function dspMistakes(t){for(var e,a=0;t[a];)e={id:a,ques:t[a].num,ans:t[a].ans},mydata.push(e),a++;$("#grid").GridUnload(),$("#grid").jqGrid({data:mydata,datatype:"local",width:250,height:"auto",rowNum:a,colNames:["Question","Answer"],colModel:[{name:"ques",index:"ques",key:!0,width:75},{name:"ans",index:"ans",width:75}],pager:"#pager",sortname:"id",viewrecords:!0,sortorder:"asc",caption:"Wrong Answers"})}function dspMistakesLINK(t){for(var e,a=0;t[a];)e={id:a,ques:t[a].num,ans:t[a].ans,res:t[a].link},mydata.push(e),a++;$("#grid").GridUnload(),$("#grid").jqGrid({data:mydata,datatype:"local",width:450,height:"auto",rowNum:a,colNames:["Question","Answer","Resource"],colModel:[{name:"ques",index:"ques",key:!0,width:75},{name:"ans",index:"ans",width:75},{name:"res",index:"res",width:210}],pager:"#pager",sortname:"id",viewrecords:!0,sortorder:"asc",caption:"Wrong Answers"})}function xmlANS(t,e,a,n,o,i,r){this.num=t+1,this.ques=e,this.ans1=a,this.ans2=n,this.ans3=o,this.ans=i,this.link='<a href="'+r+'">somewhere</a>'}function wrongAns(t,e,a,n,o,i,r){this.num=t,this.ques=e,this.ans1=a,this.ans2=n,this.ans3=o,this.ans=i,this.link=r}function getVideos(){var t=" ";try{t=getVideosXML(),$("#eVideos").html(t),$("div[data-role=page]").page("destroy").page()}catch(t){alert("getVideos: "+t.message)}}function getVideosXML(){var e,a,n,o=" ",i=0;try{return $.ajax({async:!1,type:"GET",url:"xml/I4ISvideos.xml",success:function(t){$("Videos",t).each(function(t){$(this).find("No").text(),a=(a=$(this).find("Description").text()).replace(" ","<br/>"),n=xml2html($(this).find("elink").text()),e=crtVideos(i+=1,a,n),o+=e,isEven(i)&&(o+="</tr><tr>")})},error:function(t,e,a){xmlError(t)}}),o="<table><tr>"+o+"</tr></table>"}catch(t){return void alert("getVideoXML: "+t.message)}}function crtVideos(t,e,a){var n,o,i;try{o='<iframe class="videoSize" src="'+a+'" allowfullscreen><p>No youtube access</p></iframe>',i='<h3 align="center"><font color="white">'+e+"</font></h3>",n=(isEven(t),'<td align="center">')+o+i+"</td>"}catch(t){alert("crtVideos: "+t.message)}return n}function getLocations(){var t=" ";try{t=getLocationXML(),$("#eLoc").html(t)}catch(t){alert("getLocations: "+t.message)}}function getLocationXML(){var e,t,a='<select name="nLoc" id="nLoc"><option value="ALL"> ALL </option>',n=[],o=0,i="xml/I4ISevents.xml";sPath&&(i=sPath+fl);try{for(var r in $.ajax({async:!1,type:"GET",url:i,success:function(t){$("Events",t).each(function(t){e=$(this).find("Location").text(),n[o]=e,o+=1})},error:function(t,e,a){xmlError(t)}}),n.sort(),n)n[r]!=t&&(a+='<option value="'+n[r]+'">'+n[r]+"</option>"),t=n[r];return a+="</select>"}catch(t){return void alert("getLocationXML: "+t.message)}}function mapButton(t,e){var a;onlineNet?a='<a href="'+("Map.html?"+new theEvent(t,e).serial)+'" data-role="button" data-icon="info" data-mini="true" data-theme="b">View map</a>':a="No Network connection to display Map";return a}function dateDiff(t,e){var a=new Date(e).getTime(),n=t.getTime();return parseInt((a-n)/864e5)}function getEvent(t){var e=" ";try{e=getEventXML(t),$("#eEvent").html(e),$("div[data-role=page]").page("destroy").page()}catch(t){alert("getEvent: Loc "+t.message)}}function xmlEvent(t){this.lc,this.dt,this.ds,this.tx,this.pc,this.el,this.x=t}function getEventXML(e){var a,n=" ",o=new xmlEvent(0),t="xml/I4ISevents.xml";"Y"==eXML.loaded&&(t=sPath+fl);try{return $.ajax({async:!1,type:"GET",url:t,success:function(t){$("Events",t).each(function(t){o.lc=$(this).find("Location").text(),e!=o.lc&&"ALL"!=e||(o.dt=$(this).find("EventDate").text(),o.ds=$(this).find("EventDesc").text(),o.tx=$(this).find("EventText").text(),o.pc=$(this).find("PostCode").text(),o.el=xml2html($(this).find("elink").text()),o.x=o.x+1,a=crtEvent(o),n+=a)})},error:function(t,e,a){xmlError(t)}}),n}catch(t){return void alert("getEventXML: "+t.message)}}function crtEvent(t){var e;try{var a=new xmlDate(t.dt),n="<h3>"+t.ds+"</h3>",o="<p> On: "+a.date;t.pc&&(o=o+"</p><p> At: "+t.pc+" view "+mapButton(t.pc,t.dt)+"</p>"),e='<div class="opc" data-role="collapsible">'+n+(o=(o=o+"<p>"+shareButton(t.dt,t.tx,t.ds,t.pc)+"</p>")+"<p>"+t.tx+"</p>")+"</div>"}catch(t){alert("crtEvent: "+t.message)}return e}function calendarButton(t,e){return'<a href="#" onclick="addToCalendar();"" data-role="button" data-icon="plus" data-mini="true" data-theme="b">Add to calendar</a>'}function addToCalendar(){alert("Function currently being implemented")}function shareButton(t,e,a,n){var o="( ... your message ... ) "+e;return""<n&&(o=o+" .... at "+n),'<a href="#" '+("onclick=\"window.location.href='mailto:?subject="+("I4IS Event on "+t+" - "+a)+"&body="+o+"';\"")+'" data-role="button" data-icon="forward" data-mini="true" data-theme="b">Go with a friend</a>'}function gotoELINK(t){return onlineNet?'<input type="button" value="WebPage" onclick="'+("window.open(encodeURI('"+t+"'), '_blank', 'location=yes');")+'">':'<input type="button" value="WebPage" onclick="alert("No Network connection");">'}function xmlDate(t){this.year=t.substring(0,4),this.month=t.substring(5,7),this.day=t.substring(8,10),this.date=this.day+"/"+this.month+"/"+this.year}function myPostion(t){this.loaded=t,this.latitude,this.longitude,this.altitude,this.accuracy,this.altitudeAccuracy,this.heading,this.speed,this.timestamp,this.distance=0}function theEvent(t,e){var a=new Date;this.pc=t.replace(" ","%20"),this.togo=dateDiff(a,e)+" days",this.togo=this.togo.replace(" ","%20"),this.lat=0,this.lng=0,"SW8 1SZ"==t&&(this.lat=51.48437134890335,this.lng=-.1227030232548),"SW1Y 5AG"==t&&(this.lat=51.505882426,this.lng=-.1324965655803),"37830"==t&&(this.lat=35.948828,this.lng=-84.387016),this.serial="pc="+this.pc+"&togo="+this.togo+"&lat="+this.lat+"&lng="+this.lng}$(document).on("pageshow","#mapPage",function(){var t=GetURLParameter("pc"),e=GetURLParameter("togo"),a="Distance not available";myPos.loaded&&(geoDistance(GetURLParameter("lat"),GetURLParameter("lng")),a="Distance: "+myPos.distance+" +/-"+myPos.accuracy+" km ");var n=document.getElementById("location"),o=document.getElementById("togo");n.innerHTML=t.replace("%20"," "),o.innerHTML=a+"  Time: "+e.replace("%20"," ");try{var i=GetURLParameter("pc").replace("%20"," ");geocoder=new google.maps.Geocoder,geocoder.geocode({address:i},function(t,e){if(e==google.maps.GeocoderStatus.OK){g_map.setCenter(t[0].geometry.location);new google.maps.Marker({map:g_map,position:t[0].geometry.location})}else alert("Geocode was not successful for the following reason: "+e)})}catch(t){alert("Error loading postcode: "+t.message)}}),$(document).on("pageinit","#mapPage",function(t,e){new google.maps.LatLng(51.48436,-.122691);g_map=new google.maps.Map(document.getElementById("map_canvas"),{zoom:12,center:new google.maps.LatLng(51.48436,-.122691),mapTypeId:google.maps.MapTypeId.ROADMAP})}),$(document).on("pageshow","#pageVideo",function(){navigator.onLine?getVideos():($.mobile.changePage("index.html"),alert("No Network connection - Can't access videos"))});var onLocSuccess=function(t){myPos.loaded=!0,myPos.latitude=t.coords.latitude,myPos.longitude=t.coords.longitude,myPos.accuracy=t.coords.accuracy/2e3,alertY("Position retrieved")};function onLocError(t){alertY("code: "+t.code+"\nmessage: "+t.message+"\n")}function mapLocation(){navigator.geolocation.getCurrentPosition(onLocSuccess,onLocError)}function toRad(t){return t*Math.PI/180}function geoDistance(t,e){try{if(myPos.loaded){var a=myPos.latitude,n=myPos.longitude;myPos.distance=0;var o=toRad(a-t),i=toRad(n-e),r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(toRad(t))*Math.cos(toRad(a))*Math.sin(i/2)*Math.sin(i/2),s=6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)));myPos.distance=Math.round(100*s)/100}else alertY("position not available")}catch(t){alertY("Location Error: "+t.message)}}function fileName(t){this.readFile=!1,this.f=t,this.URL,this.fpath,this.online,this.xmlDATA,this.urlDATA,this.logging=!0,this.loaded="N"}function chkEventRecord(){try{window.requestFileSystem(LocalFileSystem.PERSISTENT,0,chkFS,chkFail)}catch(t){eXML.loaded="N"}}function chkFS(t){sPath=t.root.toURL(),t.root.getFile(fl,null,chkFileEntry,chkFail)}function chkFileEntry(t){console.log("*** chkFileEntry *** SUCCESS "),eXML.url=t.toURL(),eXML.fpath=t.fullPath,eXML.loaded="Y"}function chkFail(t){console.log("*** chkFail ***: "+t.code),eXML.loaded="N"}